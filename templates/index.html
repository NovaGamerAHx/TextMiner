<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TextMiner | Ø¬Ø³ØªØ¬ÙˆÛŒ Ù‡ÙˆØ´Ù…Ù†Ø¯ Ø¯Ø± Ù…ØªÙ†</title>
    <style>
        :root { --primary: #4f46e5; --bg: #f3f4f6; --card: #ffffff; --text: #1f2937; }
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background-color: var(--bg); color: var(--text); margin: 0; padding: 20px; display: flex; flex-direction: column; align-items: center; min-height: 100vh; }
        
        .container { width: 100%; max-width: 800px; background: var(--card); padding: 2rem; border-radius: 16px; box-shadow: 0 10px 25px rgba(0,0,0,0.05); }
        
        h1 { text-align: center; color: var(--primary); margin-bottom: 10px; }
        p.subtitle { text-align: center; color: #6b7280; margin-bottom: 30px; font-size: 0.9rem; }
        
        .form-group { margin-bottom: 20px; }
        label { display: block; margin-bottom: 8px; font-weight: bold; font-size: 0.95rem; }
        
        input[type="text"], input[type="file"] { width: 100%; padding: 12px; border: 2px solid #e5e7eb; border-radius: 8px; font-family: inherit; box-sizing: border-box; transition: 0.3s; }
        input[type="text"]:focus { border-color: var(--primary); outline: none; }
        
        button { width: 100%; background-color: var(--primary); color: white; padding: 14px; border: none; border-radius: 8px; font-size: 1rem; font-weight: bold; cursor: pointer; transition: 0.3s; margin-top: 10px; }
        button:hover { background-color: #4338ca; }
        button:disabled { background-color: #9ca3af; cursor: not-allowed; }
        
        /* Ø¨Ø®Ø´ Ù†ØªØ§ÛŒØ¬ */
        #results-area { margin-top: 30px; display: none; }
        .result-card { background: #f9fafb; border-right: 4px solid var(--primary); padding: 15px; margin-bottom: 15px; border-radius: 6px; line-height: 1.6; font-size: 0.95rem; text-align: justify; }
        .result-badge { font-size: 0.8rem; color: #6b7280; margin-bottom: 5px; display: block; }
        
        .loader { border: 3px solid #f3f3f3; border-top: 3px solid var(--primary); border-radius: 50%; width: 24px; height: 24px; animation: spin 1s linear infinite; margin: 0 auto; display: none; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
    </style>
</head>
<body>

<div class="container">
    <h1>ğŸ’ TextMiner</h1>
    <p class="subtitle">ÙØ§ÛŒÙ„ Ù…ØªÙ†ÛŒ Ø®ÙˆØ¯ Ø±Ø§ Ø¢Ù¾Ù„ÙˆØ¯ Ú©Ù†ÛŒØ¯ Ùˆ Ø³ÙˆØ§Ù„ Ø¨Ù¾Ø±Ø³ÛŒØ¯. Ù…Ø§ Ù…Ø±ØªØ¨Ø·â€ŒØªØ±ÛŒÙ† Ø¨Ø®Ø´â€ŒÙ‡Ø§ Ø±Ø§ Ù¾ÛŒØ¯Ø§ Ù…ÛŒâ€ŒÚ©Ù†ÛŒÙ….</p>
    
    <div class="form-group">
        <label for="file-input">Û±. Ø§Ù†ØªØ®Ø§Ø¨ ÙØ§ÛŒÙ„ Ù…ØªÙ†ÛŒ (.txt)</label>
        <input type="file" id="file-input" accept=".txt">
    </div>
    
    <div class="form-group">
        <label for="prompt-input">Û². Ø³ÙˆØ§Ù„ ÛŒØ§ Ø¹Ø¨Ø§Ø±Øª Ù…ÙˆØ±Ø¯ Ø¬Ø³ØªØ¬Ùˆ</label>
        <input type="text" id="prompt-input" placeholder="Ù…Ø«Ù„Ø§: Ù†Ø¸Ø± Ù†ÙˆÛŒØ³Ù†Ø¯Ù‡ Ø¯Ø± Ù…ÙˆØ±Ø¯ Ù‡ÙˆØ´ Ù…ØµÙ†ÙˆØ¹ÛŒ Ú†ÛŒØ³ØªØŸ">
    </div>

    <button id="submit-btn" onclick="analyzeText()">
        <span id="btn-text">Ø¬Ø³ØªØ¬Ùˆ Ùˆ ØªØ­Ù„ÛŒÙ„</span>
        <div class="loader" id="loader"></div>
    </button>

    <div id="results-area">
        <h3>ğŸ” Ù†ØªØ§ÛŒØ¬ ÛŒØ§ÙØª Ø´Ø¯Ù‡ (Ûµ Ù…ÙˆØ±Ø¯ Ø¨Ø±ØªØ±):</h3>
        <div id="chunks-container"></div>
    </div>
</div>

<script>
    async function analyzeText() {
        const fileInput = document.getElementById('file-input');
        const promptInput = document.getElementById('prompt-input');
        const file = fileInput.files[0];
        const prompt = promptInput.value;

        if (!file || !prompt) {
            alert("Ù„Ø·ÙØ§ Ù‡Ù… ÙØ§ÛŒÙ„ Ø±Ø§ Ø§Ù†ØªØ®Ø§Ø¨ Ú©Ù†ÛŒØ¯ Ùˆ Ù‡Ù… Ø³ÙˆØ§Ù„ Ø±Ø§ Ø¨Ù†ÙˆÛŒØ³ÛŒØ¯.");
            return;
        }

        // UI Loading State
        const btn = document.getElementById('submit-btn');
        const btnText = document.getElementById('btn-text');
        const loader = document.getElementById('loader');
        
        btn.disabled = true;
        btnText.style.display = 'none';
        loader.style.display = 'block';
        document.getElementById('results-area').style.display = 'none';

        // Prepare Data
        const formData = new FormData();
        formData.append('file', file);
        formData.append('prompt', prompt);

        try {
            const response = await fetch('/analyze', {
                method: 'POST',
                body: formData
            });

            const data = await response.json();

            if (data.error) {
                alert("Ø®Ø·Ø§: " + data.error);
            } else {
                displayResults(data.results);
            }

        } catch (error) {
            alert("Ø®Ø·Ø§ Ø¯Ø± Ø¨Ø±Ù‚Ø±Ø§Ø±ÛŒ Ø§Ø±ØªØ¨Ø§Ø· Ø¨Ø§ Ø³Ø±ÙˆØ±");
            console.error(error);
        } finally {
            btn.disabled = false;
            btnText.style.display = 'inline';
            loader.style.display = 'none';
        }
    }

    function displayResults(chunks) {
        const container = document.getElementById('chunks-container');
        container.innerHTML = '';

        chunks.forEach((chunk, index) => {
            const div = document.createElement('div');
            div.className = 'result-card';
            div.innerHTML = `
                <span class="result-badge">Ø±ØªØ¨Ù‡ Ù…Ø±ØªØ¨Ø· Ø¨ÙˆØ¯Ù†: #${index + 1}</span>
                ${chunk.replace(/\n/g, '<br>')}
            `;
            container.appendChild(div);
        });

        document.getElementById('results-area').style.display = 'block';
    }
</script>

</body>
</html>